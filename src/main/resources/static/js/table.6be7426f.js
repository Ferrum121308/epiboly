(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["table"],{"3e92":function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"crumbs"},[s("el-breadcrumb",{attrs:{separator:"/"}},[s("el-breadcrumb-item",[s("i",{staticClass:"el-icon-lx-cascades"}),e._v(" 用户管理\n            ")])],1)],1),s("div",{staticClass:"container"},[s("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:e.tableData.filter((function(t){return!e.search||(t.userId+"").includes(e.search)||t.userName.toLowerCase().includes(e.search.toLowerCase())})).slice((e.currentPage-1)*e.pageSize,e.currentPage*e.pageSize),border:"","header-cell-class-name":"table-header"},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"expand",width:"55",align:"center",prop:"date"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.roles,(function(n,r){return s("el-row",{key:n.roleId,class:["vcenter","bottom"]},[s("el-col",{attrs:{span:5}},[s("el-tag",{attrs:{closable:"",size:"medium"},on:{close:function(s){return e.removePermissionById(t.row.roles,n.roleId)}}},[e._v(e._s(n.roleName))]),s("i",{staticClass:"el-icon-caret-right"})],1),s("el-col",{attrs:{span:19}},e._l(n.permissions,(function(t,n){return s("el-row",{key:t.permissionId,class:["vcenter"]},[s("el-col",[s("el-tag",{attrs:{size:"medium",type:"success"}},[e._v(e._s(t.permissionName))])],1)],1)})),1)],1)}))}}])}),s("el-table-column",{attrs:{prop:"userId",label:"ID",width:"55",align:"center"}}),s("el-table-column",{attrs:{prop:"userName",label:"用户名"}}),s("el-table-column",{attrs:{prop:"password",label:"密码"}}),s("el-table-column",{attrs:{prop:"phoneNum",label:"联系方式"}}),s("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"header",fn:function(t){return[s("el-input",{attrs:{size:"mini",placeholder:"输入关键字搜索"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]}},{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(s){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑信息")]),s("el-button",{staticClass:"green",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(s){return e.handleRole(t.$index,t.row)}}},[e._v("分配角色")]),s("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(s){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),s("el-dialog",{attrs:{title:"编辑",visible:e.editVisible,width:"30%"},on:{"update:visible":function(t){e.editVisible=t}}},[s("el-form",{ref:"form",attrs:{model:e.form,"label-width":"70px"}},[s("el-form-item",{attrs:{label:"密码"}},[s("el-input",{model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),s("el-form-item",{attrs:{label:"联系方式"}},[s("el-input",{model:{value:e.form.phoneNum,callback:function(t){e.$set(e.form,"phoneNum",t)},expression:"form.phoneNum"}})],1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.editVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.saveEdit}},[e._v("确 定")])],1)],1),s("el-pagination",{attrs:{align:"center","current-page":e.currentPage,"page-sizes":[1,5,10,20],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.tableData.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),s("el-dialog",{attrs:{title:"角色分配",visible:e.setRoleDialogVisible,width:"50%"},on:{"update:visible":function(t){e.setRoleDialogVisible=t}}},[s("el-tree",{ref:"treeRef",attrs:{"show-checkbox":"",data:e.rolesList,props:e.defaultProps,"node-key":"permissionId","default-expand-all":"","default-checked-keys":e.roleKeys}}),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.setRoleDialogVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.saveRole}},[e._v("确 定")])],1)],1)],1)},r=[];function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,n=new Array(t);s<t;s++)n[s]=e[s];return n}function o(e){if(Array.isArray(e))return i(e)}function a(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function l(e,t){if(e){if("string"===typeof e)return i(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?i(e,t):void 0}}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e){return o(e)||a(e)||l(e)||c()}s("ac6a"),s("a481");var d={name:"basetable",data:function(){return{currentPage:1,pageSize:5,tableData:[],multipleSelection:[],delList:[],editVisible:!1,setRoleDialogVisible:!1,pageTotal:0,form:{},idx:-1,id:-1,search:"",rolesList:[],defaultProps:{children:"permissions",label:"permissionName"},roleKeys:[],userId:""}},created:function(){this.getData()},methods:{getData:function(){var e=this;this.$http.get("/user/findAllUsers").then((function(t){"200"==t.status?(e.tableData=t.data,e.pageTotal=t.data.length):e.$message.error("请求错误")})).catch((function(e){console.log(e)}))},removePermissionById:function(e,t){var s=this;this.$confirm("确定要删除吗？","提示",{type:"warning"}).then((function(){s.$message.success("删除成功"+t)})).catch((function(){s.$message.warning("取消删除")}))},handleDelete:function(e,t){var s=this;this.$confirm("确定要删除吗？","提示",{type:"warning"}).then((function(){console.log(t.userId),s.$http.get("/user/delete?userId="+t.userId).then((function(e){200==e.status&&s.$message.success("删除成功！")})).catch((function(e){return console.log(e)})),s.tableData.splice(e,1)})).catch((function(){}))},handleRole:function(e,t){var s=this;this.userId=t.userId,this.$http.get("role/findAllRoles").then((function(e){if(200==e.status){var n=e.data;for(var r in n)n[r]=JSON.parse(JSON.stringify(n[r]).replace(/roleName/g,"permissionName")),"商家"==n[r].permissionName?n[r].permissions.forEach((function(e){e.permissionId="B"+e.permissionId})):"顾客"==n[r].permissionName?n[r].permissions.forEach((function(e){e.permissionId="C"+e.permissionId})):n[r].permissions.forEach((function(e){e.permissionId="M"+e.permissionId}));t.roles.forEach((function(e){"商家"==e.roleName?e.permissions.forEach((function(e){e.permissionId="B"+e.permissionId})):"顾客"==e.roleName?e.permissions.forEach((function(e){e.permissionId="C"+e.permissionId})):e.permissions.forEach((function(e){e.permissionId="M"+e.permissionId}))})),s.rolesList=n,s.roleKeys=[],s.getLeafKeys(t,s.roleKeys)}else s.$message.error("请求错误，获取失败！")})).catch((function(e){return console.log(e)})),this.setRoleDialogVisible=!0},handleSelectionChange:function(e){this.multipleSelection=e},handleEdit:function(e,t){this.idx=e,this.form=t,this.userId=t.userId,this.editVisible=!0},saveEdit:function(){var e=this;this.editVisible=!1;var t={};t.userId=this.userId,t.password=this.form.password,t.phoneNum=this.form.phoneNum,this.$http.post("/user/save",t).then((function(t){200==t.status?e.$message.success("编辑成功！"):e.$message.error("编辑失败！")})).catch((function(e){console.log(e)})),this.$set(this.tableData,this.idx,this.form)},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e},handleCurrentChange:function(e){this.currentPage=e},getLeafKeys:function(e,t){e.roles.forEach((function(e){e.permissions.forEach((function(e){t.push(e.permissionId)}))}))},saveRole:function(){var e=this,t=[].concat(u(this.$refs.treeRef.getCheckedNodes()),u(this.$refs.treeRef.getHalfCheckedNodes())),s="",n=this.userId;t.forEach((function(e){e.roleId&&(s+=","+e.permissionName)}));var r={};r.userId=n,r.role=s,this.$http.post("/user/save",r).then((function(t){200==t.status?e.$message.success("分配成功！"):e.$message.error("分配失败！")})).catch((function(e){console.log(e)})),this.setRoleDialogVisible=!1}}},f=d,p=(s("f450"),s("2877")),h=Object(p["a"])(f,n,r,!1,null,"4daecd32",null);t["default"]=h.exports},"4ba7":function(e,t,s){},f450:function(e,t,s){"use strict";s("4ba7")}}]);
//# sourceMappingURL=table.6be7426f.js.map